<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽奖概率管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-md">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">抽奖概率管理</h1>
        
        <div id="controls-container" class="space-y-6"></div>
        
        <div class="mt-8 flex justify-between items-center p-4 bg-gray-50 rounded-lg">
            <span class="font-semibold text-gray-700">总概率：</span>
            <span id="total-probability" class="text-xl font-bold text-green-600">100%</span>
        </div>
        
        <div class="mt-8 flex flex-col sm:flex-row gap-4">
            <button id="save-btn" class="flex-1 py-3 px-6 bg-blue-600 text-white font-bold rounded-lg shadow hover:bg-blue-700 transition-colors">
                生成并下载新配置 (config.json)
            </button>
            <a href="chou.html" target="_blank" class="flex-1 py-3 px-6 bg-gray-200 text-gray-800 font-bold rounded-lg shadow hover:bg-gray-300 transition-colors text-center">
                访问抽奖页面
            </a>
        </div>
    </div>

    <script>
        let PRIZE_CONFIG = [
            { id: 1, name: '一等奖', color: '#FF6B6B', probability: 5 },
            { id: 2, name: '二等奖', color: '#FF9F43', probability: 10 },
            { id: 3, name: '三等奖', color: '#FFD166', probability: 15 },
            { id: 4, name: '四等奖', color: '#06D6A0', probability: 20 },
            { id: 5, name: '五等奖', color: '#118AB2', probability: 25 },
            { id: 6, name: '六等奖', color: '#073B4C', probability: 25 }
        ];

        const controlsContainer = document.getElementById('controls-container');
        const totalProbabilityEl = document.getElementById('total-probability');
        const saveBtn = document.getElementById('save-btn');

        function updateTotalProbability() {
            const total = PRIZE_CONFIG.reduce((sum, prize) => sum + prize.probability, 0);
            totalProbabilityEl.textContent = `${total}%`;
            totalProbabilityEl.className = `text-xl font-bold ${total === 100 ? 'text-green-600' : 'text-red-600'}`;
        }

        function renderControls() {
            controlsContainer.innerHTML = '';
            PRIZE_CONFIG.forEach(prize => {
                const group = document.createElement('div');
                group.className = 'space-y-2';
                
                const label = document.createElement('label');
                label.className = 'block text-sm font-medium text-gray-700';
                label.textContent = `${prize.name} (当前: ${prize.probability}%)`;
                
                const slider = document.createElement('input');
                slider.type = 'range';
                slider.min = 0;
                slider.max = 100;
                slider.value = prize.probability;
                slider.className = 'w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer';
                // 设置滑块背景色
                const percentage = (prize.probability / 100) * 100;
                slider.style.background = `linear-gradient(to right, ${prize.color} 0%, ${prize.color} ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;

                slider.addEventListener('input', (e) => {
                    prize.probability = parseInt(e.target.value);
                    // 更新滑块背景
                    const newPercentage = (prize.probability / 100) * 100;
                    e.target.style.background = `linear-gradient(to right, ${prize.color} 0%, ${prize.color} ${newPercentage}%, #e5e7eb ${newPercentage}%, #e5e7eb 100%)`;
                    // 更新标签
                    label.textContent = `${prize.name} (当前: ${prize.probability}%)`;
                    // 更新总概率
                    updateTotalProbability();
                });
                
                group.appendChild(label);
                group.appendChild(slider);
                controlsContainer.appendChild(group);
            });
            updateTotalProbability();
        }

        function saveConfig() {
            const total = PRIZE_CONFIG.reduce((sum, prize) => sum + prize.probability, 0);
            if (total !== 100) {
                alert(`总概率必须等于100%，当前为 ${total}%。请重新调整！`);
                return;
            }
            
            const dataStr = JSON.stringify(PRIZE_CONFIG, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'config.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('新的配置文件 config.json 已生成并下载！请将此文件上传到你的GitHub仓库根目录以覆盖旧文件。');
        }

        // 初始化
        // 尝试从 config.json 加载当前配置
        fetch('config.json')
            .then(response => {
                if (!response.ok) throw new Error('配置文件不存在或无法访问，将使用默认配置。');
                return response.json();
            })
            .then(data => {
                PRIZE_CONFIG = data;
                renderControls();
            })
            .catch(error => {
                console.warn(error);
                // 如果加载失败，使用默认配置渲染
                renderControls();
            });

        saveBtn.addEventListener('click', saveConfig);
    </script>
</body>
</html>